---           
layout: post
title: Restart, Start and Stop Tomcat using Bash
date: 2017-01-19 08:54:44 UTC
updated: 2017-01-19 08:54:44 UTC
comments: false
categories: 
---

$CATALINA_PID is the Environment Variable that has path of the file which should contains the pid of the catalina/tomcat startup java process.<br /><br />Typically, this will be under /bin folder in your Tomcat installation.<br /><br />For example, you could have this in your ~/.bashrc<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>CATALINA_BASE="/opt/tomcat8"<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>export CATALINA_BASE<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>CATALINA_PID="$CATALINA_BASE/bin/catalina.pid"<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>export CATALINA_PID<br /><br />By having this $CATALINA_PID environment variable set up, we can easily get the pid of the Tomcat process and control it as we want.<br /><br />I created two scripts<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>(1) check-tomcat : To check if Tomcat is running, by reading the Tomcat PID file<br /><span class="Apple-tab-span" style="white-space: pre;"> </span>(2) restart-tomcat : To kill the tomcat, clear the Tomcat's work folder and restart Tomcat<br /><br /><br />check-tomcat<br />============<br /><span style="font-family: Courier New, Courier, monospace;">#!/bin/bash</span><br /><span style="font-family: Courier New, Courier, monospace;">#title &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>: <span class="Apple-tab-span" style="white-space: pre;"> </span>check-tomcat</span><br /><span style="font-family: Courier New, Courier, monospace;">#description &nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>: <span class="Apple-tab-span" style="white-space: pre;"> </span>This script will check if Tomcat is running and return the pid</span><br /><span style="font-family: Courier New, Courier, monospace;">#author<span class="Apple-tab-span" style="white-space: pre;">  </span> <span class="Apple-tab-span" style="white-space: pre;"> </span> <span class="Apple-tab-span" style="white-space: pre;"> </span>:<span class="Apple-tab-span" style="white-space: pre;"> </span>Raf</span><br /><span style="font-family: Courier New, Courier, monospace;">#note<span class="Apple-tab-span" style="white-space: pre;">   </span> <span class="Apple-tab-span" style="white-space: pre;"> </span>: <span class="Apple-tab-span" style="white-space: pre;"> </span>Requires $CATALINA_BASE/bin/catalina.pid to be created and $CATALINA_PID to be set.</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">clear&nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">if [ -f "$CATALINA_PID" ]; then</span><br /><span style="font-family: Courier New, Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>read kpid &lt; "$CATALINA_PID"</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp;&nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; if ps --pid $kpid 2&gt;&amp;1 1&gt;/dev/null; then</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; echo "Tomcat is already running at ${kpid}"</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; else</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; echo "$CATALINA_PID found, but Tomcat is not running"</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; fi</span><br /><span style="font-family: Courier New, Courier, monospace;">fi</span><br /><br /><br />restart-tomcat<br />==============<br /><span style="font-family: Courier New, Courier, monospace;">#!/bin/bash</span><br /><span style="font-family: Courier New, Courier, monospace;">#title &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>: <span class="Apple-tab-span" style="white-space: pre;"> </span>restart-tomcat</span><br /><span style="font-family: Courier New, Courier, monospace;">#description &nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>: <span class="Apple-tab-span" style="white-space: pre;"> </span>This script will first clear the work folder and then check if Tomcat is running, kill it, and restart the tomcat again</span><br /><span style="font-family: Courier New, Courier, monospace;">#author<span class="Apple-tab-span" style="white-space: pre;">  </span> <span class="Apple-tab-span" style="white-space: pre;"> </span> <span class="Apple-tab-span" style="white-space: pre;"> </span>:<span class="Apple-tab-span" style="white-space: pre;"> </span>Raf</span><br /><span style="font-family: Courier New, Courier, monospace;">#note<span class="Apple-tab-span" style="white-space: pre;">   </span> <span class="Apple-tab-span" style="white-space: pre;"> </span>: <span class="Apple-tab-span" style="white-space: pre;"> </span>Requires $CATALINA_BASE/bin/catalina.pid to be created and $CATALINA_PID to be set.</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">echo "Clear Tomcat log...."</span><br /><span style="font-family: Courier New, Courier, monospace;">rm -fv /opt/apache-tomcat-8.0.39/logs/catalina.out&nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;">touch /opt/apache-tomcat-8.0.39/logs/catalina.out</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">echo "Clear Tomcat work folder...."</span><br /><span style="font-family: Courier New, Courier, monospace;">rm -rfv /opt/apache-tomcat-8.0.39/work/Catalina/</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;">if [ -f "$CATALINA_PID" ]; then</span><br /><span style="font-family: Courier New, Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>read kpid &lt; "$CATALINA_PID"</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp;&nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>if ps --pid $kpid 2&gt;&amp;1 1</span><br /><span style="font-family: Courier New, Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>/opt/apache-tomcat-8.0.39/bin/catalina.sh start;</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>read kpid &lt; "$CATALINA_PID"</span><br /><span style="font-family: Courier New, Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>echo "Tomcat is started at ${kpid}"</span><br /><span style="font-family: Courier New, Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>else</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>echo "Killing Tomcat...."</span><br /><span style="font-family: Courier New, Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>kill -kill $kpid</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>/opt/apache-tomcat-8.0.39/bin/catalina.sh start;</span><br /><span style="font-family: Courier New, Courier, monospace;"><br /></span><span style="font-family: Courier New, Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>read kpid &lt; "$CATALINA_PID"</span><br /><span style="font-family: Courier New, Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;">  </span>echo "Tomcat is started at ${kpid}"</span><br /><span style="font-family: Courier New, Courier, monospace;"><span class="Apple-tab-span" style="white-space: pre;"> </span>fi</span><br /><span style="font-family: Courier New, Courier, monospace;">fi</span>