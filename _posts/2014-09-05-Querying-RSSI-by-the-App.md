---           
layout: post
title: Querying RSSI by the App
date: 2014-09-05 11:21:48 UTC
updated: 2014-09-05 11:21:48 UTC
comments: false
categories: 
---

I have mentioned before that we have 2 ways to check for signal strength (which then approximates distance) of the bluetooth communication in our system, particularly between the App and the Rpi.<br /><br />&nbsp; &nbsp; 1. Query done by Rpi <br />&nbsp; &nbsp; 2. Query done by Android App<br /><br />I have not yet checked on how I can get the first step done programmatic-ally, for the purpose of integrating it into our Server program. This example showed how it is done via terminal : <a href="http://www.raspberrypi.org/phpBB3/viewtopic.php?t=47466&amp;p=372150">forum link</a>.<br /><br />However, I have a written a simple app for the 2nd method. This App catches the RSSI values of every bluetooth devices it found during 'discovery' by <i>requesting</i> an extra field in ACTION_FOUND intents of the discovery : EXTRA_RSSI. This value (of data type Short) contains the RSSI value of the remote devices found. <br /><br />Here is the snippet on how it is done:<br /><br /><span style="font-family: Courier New, Courier, monospace;">// Create a BroadcastReceiver for ACTION_FOUND</span><br /><span style="font-family: Courier New, Courier, monospace;">BroadcastReceiver receiver;</span><br /><span style="font-family: Courier New, Courier, monospace;">receiver = new BroadcastReceiver() {</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; public void onReceive(Context context, Intent intent) {</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>String action = intent.getAction();</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp; &nbsp; &nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>// When discovery finds a device</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>if (BluetoothDevice.ACTION_FOUND.equals(action)) {</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="Apple-tab-span" style="white-space: pre;"> </span></span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>// Get the BluetoothDevice object from the Intent</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>BluetoothDevice device = intent.getParcelableExtra(BluetoothDevice.EXTRA_DEVICE);</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>short rssi = intent.getShortExtra(BluetoothDevice.EXTRA_RSSI,Short.MIN_VALUE);</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>// Add the name and address to an array adapter to show in a ListView</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp;mArrayAdapter.add(device.getName() + "\n" + device.getAddress() + "\n" + rssi + " db" + "\n" );</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>//add notify discovery is done</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>Toast.makeText(getApplicationContext(),"Bluetooth devices discovery done...", Toast.LENGTH_SHORT).show();</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp;</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre;"> </span>&nbsp;}</span><br /><span style="font-family: Courier New, Courier, monospace;">&nbsp; &nbsp; &nbsp;}</span><br /><span style="font-family: Courier New, Courier, monospace;">};</span><br /><br />In short, we can get the signal strength of any discovered bluetooth devices, without even having to connect to those devices. Hence, 'signal strength' or more correctly, 'distance between the user and the door' verification can be done first before 'key' verification. Refer <a href="http://smarteac.blogspot.com/2013/10/unlocking-sending-keys-and-verification.html">HERE</a> to see the methods we proposed earlier.<br /><br />Here is the updated version of the App (remove the RSSI values display through toast, put them into the list view instead).<br /><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-c6YGzMYMgJ4/UmYrlypOs8I/AAAAAAAAAy8/cLXFgO6KinI/s1600/Screenshot-1382427596241.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://3.bp.blogspot.com/-c6YGzMYMgJ4/UmYrlypOs8I/AAAAAAAAAy8/cLXFgO6KinI/s400/Screenshot-1382427596241.png" width="266" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">Downloads:</div><a href="https://www.dropbox.com/s/pj4q1xzwhiht56s/DemoRSSI.apk">Apk</a><br /><a href="https://www.dropbox.com/s/gcyqiahngydn9ig/MainActivity.java">MainActivity (main code)</a><br /><a href="https://www.dropbox.com/s/3avxooquvk6ezn5/DemoRSSI.rar">Project files (all)</a><br /><br /><br /><br />